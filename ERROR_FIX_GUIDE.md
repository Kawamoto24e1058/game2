# ã€Œã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã€å•é¡Œã®ä¿®æ­£ã‚¬ã‚¤ãƒ‰

## å•é¡Œã®æ¦‚è¦

ã‚«ãƒ¼ãƒ‰åˆ¤å®šAPIï¼ˆ`/api/judgeCard`ï¼‰å‘¼ã³å‡ºã„æ™‚ã«ã€Œã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚ä¸»ãªåŸå› ï¼š

1. **Gemini API ã‹ã‚‰ã®ä¸æ­£ãªJSONè¿”ç­”**ï¼šãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è£…é£¾ï¼ˆ```json...```ï¼‰ã‚„è¤‡æ•°è¡Œã®è¨˜è¿°ãŒå«ã¾ã‚Œã¦ã„ãŸ
2. **JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼**ï¼šä¸æ­£ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã«ã‚ˆã‚Š JSON.parse() ãŒå¤±æ•—ã—ã¦ã„ãŸ
3. **å¤‰æ•°åã®ä¸ä¸€è‡´**ï¼šeffectName ã¨ specialEffectName ã®æ··åŒãªã©
4. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¸ååˆ†**ï¼šã€Œã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã€ã ã‘ã§åŸå› ãŒä¸æ˜ã ã£ãŸ

---

## å®Ÿè£…ã—ãŸä¿®æ­£å†…å®¹

### ã€1ã€‘ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆserver.jsï¼‰ï¼šJSON ã‚¯ãƒªãƒ¼ãƒ³å‡¦ç†ã®å¼·åŒ–

#### ä¿®æ­£ç®‡æ‰€ï¼šjudgeCardByAI é–¢æ•°ã® JSON æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯

**ç›®çš„**ï¼šGemini API ã‹ã‚‰ã®è¿”ç­”ã‹ã‚‰ã€ä½™è¨ˆãªãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è£…é£¾ã‚„ä¸æ­£ãªãƒ†ã‚­ã‚¹ãƒˆã‚’å®Œå…¨ã«å‰Šé™¤

```javascript
// â˜…ã€å³å¯†ãª JSON æŠ½å‡ºã€‘è¤‡æ•°ã®ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è£…é£¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œ
// 1. ```json...``` ãƒ–ãƒ­ãƒƒã‚¯ã®å‰Šé™¤
responseText = responseText.replace(/```json\n?/gi, '').replace(/```\n?/gi, '');

// 2. HTML ã‚¿ã‚°ã‚„ãã®ä»–ã®è£…é£¾ã‚’å‰Šé™¤ï¼ˆä¸‡ä¸€ã«å‚™ãˆã¦ï¼‰
responseText = responseText.replace(/<[^>]*>/g, '');

// 3. æ”¹è¡Œãƒ»ã‚¿ãƒ–ã‚’å®Œå…¨ã«å‰Šé™¤ï¼ˆè¤‡æ•°è¡ŒJSON ã«å¯¾å¿œï¼‰
responseText = responseText.replace(/\r?\n/g, '').replace(/\t/g, '');

// 4. ä½™åˆ†ãªã‚¹ãƒšãƒ¼ã‚¹ã‚’ãƒˆãƒªãƒ 
responseText = responseText.trim();

// 5. JSON ã®å‰å¾Œã«ã‚ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰Šé™¤ï¼ˆ"{"ã¨"}"ã®é–“ã ã‘æŠ½å‡ºï¼‰
const jsonMatch = responseText.match(/\{[\s\S]*\}/);
if (jsonMatch) {
  responseText = jsonMatch[0];
}
```

**åŠ¹æœ**ï¼š
- âœ… ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è£…é£¾ã‚’ç¢ºå®Ÿã«å‰Šé™¤
- âœ… HTML ã‚¿ã‚°ãªã©äºˆæœŸã—ãªã„ãƒ†ã‚­ã‚¹ãƒˆã‚’é™¤å»
- âœ… è¤‡æ•°è¡Œã«åˆ†å‰²ã•ã‚ŒãŸJSON ã«å¯¾å¿œ
- âœ… JSON ä»¥å¤–ã®ãƒ†ã‚­ã‚¹ãƒˆãŒå‰å¾Œã«ä»˜åŠ ã•ã‚Œã¦ã„ã¦ã‚‚æŠ½å‡ºå¯èƒ½

---

### ã€2ã€‘ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆserver.jsï¼‰ï¼šGemini ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å¼·åŒ–

#### ä¿®æ­£ç®‡æ‰€ï¼šjudgeCardByAI é–¢æ•°ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–‡

**è¿½åŠ ã—ãŸå¿µæŠ¼ã—è¡¨ç¾**ï¼š
```
ã€è¶…é‡è¦ã€‘ã‚ãªãŸã¯ JSON å‡ºåŠ›å°‚ç”¨ã®ã‚²ãƒ¼ãƒ åˆ¤å®šã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚
...
ã€çµ¶å¯¾ãƒ«ãƒ¼ãƒ«ã€‘
- å‡ºåŠ›ã™ã‚‹ã®ã¯ JSON ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ 1 ã¤ã ã‘
- ãƒ†ã‚­ã‚¹ãƒˆèª¬æ˜ã¯ä¸€åˆ‡ä¸è¦
- ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ï¼ˆ```json ãªã©ï¼‰ã§å›²ã¾ãªã„
- æ”¹è¡Œã¯å«ã‚ãªã„
- JSON ä»¥å¤–ã®æ–‡å­—ã¯ä¸€åˆ‡å«ã‚ãªã„
```

**åŠ¹æœ**ï¼š
- âœ… AIãŒ JSON ã®ã¿å‡ºåŠ›ã™ã‚‹æ„è­˜ã‚’å¼·åŒ–
- âœ… ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è£…é£¾ã‚’é¿ã‘ã‚‹ã‚ˆã†æ˜ç¤ºçš„ã«æŒ‡ç¤º
- âœ… è¤‡æ•°è¡Œå‡ºåŠ›ã‚’ç¦æ­¢

---

### ã€3ã€‘ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆserver.jsï¼‰ï¼šè©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®è¿½åŠ 

#### ä¿®æ­£ç®‡æ‰€ï¼šjudgeCardByAI é–¢æ•°ã¨ /api/judgeCard ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**æ–°ã—ã„ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**ï¼š

```javascript
// JSON ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼æ™‚
console.error(`âŒ JSON ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${parseError.message}`);
console.error(`   å…¥åŠ›æ–‡å­—åˆ—: ${responseText}`);

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—æ™‚
console.error(`âŒ å¿…é ˆã‚­ãƒ¼ãŒä¸è¶³: ${missing.join(', ')} | ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿: ${JSON.stringify(parsed)}`);

// effectTarget ç„¡åŠ¹æ™‚
console.warn(`âš ï¸ ç„¡åŠ¹ãª effectTarget: "${effectTarget}" (type: "${parsed.type}", æœ‰åŠ¹å€¤: ${allowedTargets.join(', ')}) â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨`);

// æˆåŠŸæ™‚
console.log(`âœ… judgeCardByAI æˆåŠŸ: type="${parsed.type}", finalValue=${finalValue}, effectTarget="${effectTarget}"`);

// ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå¤±æ•—æ™‚
console.error(`âŒ /api/judgeCard: cardName ãŒç„¡åŠ¹ (å—ã‘å–ã‚Šå€¤: ${JSON.stringify(cardName)})`);

// ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæˆåŠŸæ™‚
console.log(`âœ… /api/judgeCard å¿œç­”å®Œäº†: ${JSON.stringify(responseData)}`);
```

**åŠ¹æœ**ï¼š
- âœ… ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã§è©³ç´°ãªå¤±æ•—åŸå› ã‚’ç¢ºèªå¯èƒ½
- âœ… ã©ã®æ®µéšã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‹ç‰¹å®šã§ãã‚‹
- âœ… ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã‚„ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒæ˜ç¢ºã«åŒºåˆ¥ã§ãã‚‹

---

### ã€4ã€‘ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆtest-judge.htmlï¼‰ï¼šAPI å‘¼ã³å‡ºã—ã®å¼·åŒ–ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### ä¿®æ­£ç®‡æ‰€ï¼šjudgeCard() é–¢æ•°

**è¿½åŠ ã—ãŸæ¤œæŸ»**ï¼š

```javascript
// â˜… API ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡æ™‚ã®ãƒ­ã‚°
console.log(`ğŸ“¤ API ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡: cardName="${cardName}"`);

// â˜… ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡æ™‚ã®ãƒ­ã‚°
console.log(`ğŸ“¥ API ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡: status=${response.status}`);

// â˜… è§£ææ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®ãƒ­ã‚°
console.log(`ğŸ“Š è§£ææ¸ˆã¿ãƒ‡ãƒ¼ã‚¿:`, data);

// â˜… data.type ã® undefined ãƒã‚§ãƒƒã‚¯
if (!data.type || data.type === undefined) {
  const errorMsg = `ãƒ‡ãƒ¼ã‚¿å½¢å¼ç•°å¸¸: type ãŒ undefined (å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿: ${JSON.stringify(data)})`;
  console.error(`âŒ ${errorMsg}`);
  throw new Error(errorMsg);
}

// â˜… data.finalValue ã® undefined ãƒã‚§ãƒƒã‚¯
if (data.finalValue === undefined || data.finalValue === null) {
  const errorMsg = `ãƒ‡ãƒ¼ã‚¿å½¢å¼ç•°å¸¸: finalValue ãŒ undefined (å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿: ${JSON.stringify(data)})`;
  console.error(`âŒ ${errorMsg}`);
  throw new Error(errorMsg);
}
```

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**ï¼š

```javascript
let userMessage = error.message;
if (error.message.includes('JSON')) {
  userMessage = 'âš ï¸ ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚¨ãƒ©ãƒ¼: AIã‹ã‚‰ã®è¿”ç­”ãŒä¸æ­£ã§ã™ï¼ˆJSON ãƒ‘ãƒ¼ã‚¹å¤±æ•—ï¼‰';
} else if (error.message.includes('undefined')) {
  userMessage = 'âš ï¸ ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚¨ãƒ©ãƒ¼: å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä¸è¶³ã—ã¦ã„ã¾ã™';
} else if (error.message.includes('Failed to fetch')) {
  userMessage = 'âš ï¸ é€šä¿¡ã‚¨ãƒ©ãƒ¼: ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“';
}
```

**åŠ¹æœ**ï¼š
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åŸå› ãŒä½•ã§ã‚ã‚‹ã‹åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜
- âœ… ãƒ–ãƒ©ã‚¦ã‚¶ã® Developer Tools ã§ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã‚ˆã†èª˜å°
- âœ… è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›

---

### ã€5ã€‘ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆtest-judge.htmlï¼‰ï¼šdisplayResult é–¢æ•°ã§ã® undefined ãƒã‚§ãƒƒã‚¯

#### ä¿®æ­£ç®‡æ‰€ï¼šdisplayResult() é–¢æ•°ã®æœ€åˆ

```javascript
// â˜… å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã® undefined ãƒã‚§ãƒƒã‚¯
if (!data || !data.type || data.finalValue === undefined || !data.cardName) {
  const errorMsg = `displayResult ã‚¨ãƒ©ãƒ¼: å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä¸è¶³ (data=${JSON.stringify(data)})`;
  console.error(`âŒ ${errorMsg}`);
  resultDiv.innerHTML = `<div class="error">${errorMsg}</div>`;
  resultDiv.classList.add('show');
  return;
}
```

**åŠ¹æœ**ï¼š
- âœ… ãƒ‡ãƒ¼ã‚¿å½¢å¼ç•°å¸¸ã‚’ã™ãã«æ¤œå‡º
- âœ… ä¸æ­£ãƒ‡ãƒ¼ã‚¿ã§ã‚‚ç”»é¢ãŒæ­¢ã¾ã‚‰ãªã„

---

### ã€6ã€‘ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆtest-judge.htmlï¼‰ï¼šapplySupport() é–¢æ•°ã§ã®æ¤œè¨¼

#### ä¿®æ­£ç®‡æ‰€ï¼šapplySupport() é–¢æ•°ã®æœ€åˆ

```javascript
// â˜… å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã® undefined ãƒã‚§ãƒƒã‚¯
if (!data || data.finalValue === undefined || !data.effectTarget) {
  const errorMsg = `applySupport ã‚¨ãƒ©ãƒ¼: å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä¸è¶³ (data=${JSON.stringify(data)})`;
  console.error(`âŒ ${errorMsg}`);
  return;
}

// â˜… æœ‰åŠ¹ãª effectTarget ã‹ãƒã‚§ãƒƒã‚¯
const validTargets = ['player_hp', 'player_attack', 'enemy_attack', 'player_speed'];
if (!validTargets.includes(target)) {
  console.error(`âŒ applySupport ã‚¨ãƒ©ãƒ¼: ç„¡åŠ¹ãª effectTarget="${target}"`);
  return;
}

// â˜… ãƒ­ã‚°ã‚’å‡ºåŠ›
console.log(`âœ¨ ã‚µãƒãƒ¼ãƒˆåŠ¹æœé©ç”¨: ${effectName} (target=${target}, value=${value})`);
```

**åŠ¹æœ**ï¼š
- âœ… ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰å‡¦ç†ã§ã®ä¸æ­£ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- âœ… effectTarget ã®å¦¥å½“æ€§ã‚’ç¢ºèª
- âœ… å‡¦ç†ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚ŒãŸå ´åˆã‚’ãƒ­ã‚°ã§ç¢ºèªå¯èƒ½

---

### ã€7ã€‘ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆtest-judge.htmlï¼‰ï¼šupdateGameStateDisplay() ã§ã®è¦ç´ å­˜åœ¨ç¢ºèª

#### ä¿®æ­£ç®‡æ‰€ï¼šupdateGameStateDisplay() é–¢æ•°

```javascript
// â˜… å„è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¦ã‹ã‚‰æ›´æ–°
const playerHpEl = document.getElementById('playerHp');
const playerAtkEl = document.getElementById('playerAttack');
const playerSpdEl = document.getElementById('playerSpeed');
const enemyAtkEl = document.getElementById('enemyAttack');

if (playerHpEl) playerHpEl.textContent = gameState.playerHp;
else console.warn(`âš ï¸ è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: #playerHp`);

if (playerAtkEl) playerAtkEl.textContent = gameState.playerAttack;
else console.warn(`âš ï¸ è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: #playerAttack`);

// ... ä»¥é™ã‚‚åŒæ§˜
```

**åŠ¹æœ**ï¼š
- âœ… DOMè¦ç´ ãŒãªã„å ´åˆã‚’äº‹å‰ã«æ¤œå‡º
- âœ… è¦ç´ ãŒãªãã¦ã‚‚å‡¦ç†ãŒç¶šè¡Œã•ã‚Œã‚‹ï¼ˆä¸ç™ºæ‰±ã„ï¼‰
- âœ… å•é¡Œç®‡æ‰€ãŒãƒ­ã‚°ã«æ˜ç¢ºã«è¡¨ç¤ºã•ã‚Œã‚‹

---

## ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### 1. ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®ãƒ­ã‚°ç¢ºèª

F12ã‚­ãƒ¼ã‚’æŠ¼ã™ â†’ Console ã‚¿ãƒ–ã‚’é¸æŠ

**ç¢ºèªã§ãã‚‹ãƒ­ã‚°**ï¼š

| ãƒ­ã‚° | æ„å‘³ | ä¾‹ |
|------|------|-----|
| `ğŸ“¤ API ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡` | API ã‚’å‘¼ã³å‡ºã—ãŸ | `ğŸ“¤ API ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡: cardName="ç‚"` |
| `ğŸ“ Gemini raw response` | Gemini ã®ç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ | `ğŸ“ Gemini raw response: {"type":"attack"...}` |
| `ğŸ” Cleaned JSON` | ã‚¯ãƒªãƒ¼ãƒ³ã•ã‚ŒãŸJSON | `ğŸ” Cleaned JSON: {"type":"attack"...}` |
| `âœ… judgeCardByAI æˆåŠŸ` | AIå‡¦ç†ãŒæˆåŠŸ | `âœ… judgeCardByAI æˆåŠŸ: type="attack"...` |
| `âš ï¸ ç„¡åŠ¹ãª effectTarget` | effectTarget ãŒä¸æ­£ | `âš ï¸ ç„¡åŠ¹ãª effectTarget: "invalid"...` |
| `âŒ JSON ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼` | JSONè§£æå¤±æ•— | `âŒ JSON ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: SyntaxError...` |
| `ğŸ“Š è§£ææ¸ˆã¿ãƒ‡ãƒ¼ã‚¿` | ãƒ•ãƒ­ãƒ³ãƒˆå´ãŒå—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ | `ğŸ“Š è§£ææ¸ˆã¿ãƒ‡ãƒ¼ã‚¿: {success:true...}` |
| `âœ¨ ã‚µãƒãƒ¼ãƒˆåŠ¹æœé©ç”¨` | ã‚µãƒãƒ¼ãƒˆå‡¦ç†ãŒå®Ÿè¡Œ | `âœ¨ ã‚µãƒãƒ¼ãƒˆåŠ¹æœé©ç”¨: è–ãªã‚‹ç™’ã‚„ã—...` |

### 2. Network ã‚¿ãƒ–ã§ã® API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¢ºèª

F12 â†’ Network ã‚¿ãƒ– â†’ `/api/judgeCard` ã‚’ã‚¯ãƒªãƒƒã‚¯

**ç¢ºèªé …ç›®**ï¼š
- Status: 200 OKï¼ˆæˆåŠŸï¼‰
- Response ã‚¿ãƒ–ï¼šè¿”ã•ã‚ŒãŸJSONãƒ‡ãƒ¼ã‚¿
  ```json
  {
    "success": true,
    "cardName": "ç‚",
    "type": "attack",
    "finalValue": 65,
    "specialEffectName": "ç«ã ã‚‹ã¾",
    "specialEffectDescription": "æ•µã‚’æ¯ã‚¿ãƒ¼ãƒ³ç‡ƒã‚„ã™",
    "effectTarget": "enemy_hp"
  }
  ```

### 3. ã‚µãƒ¼ãƒãƒ¼ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã®ãƒ­ã‚°ç¢ºèª

ã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ç«¯æœ«ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ã‚’ç¢ºèªï¼š

```
ğŸƒ ã‚«ãƒ¼ãƒ‰åˆ¤å®šãƒªã‚¯ã‚¨ã‚¹ãƒˆ: "ç‚"
ğŸ“ Gemini raw response: {"type":"attack",...}
ğŸ” Cleaned JSON: {"type":"attack",...}
âœ… judgeCardByAI æˆåŠŸ: type="attack", finalValue=65...
âœ… /api/judgeCard å¿œç­”å®Œäº†: {"success":true,...}
```

---

## ãƒ†ã‚¹ãƒˆæ‰‹é †

### âœ… æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ

1. `test-judge.html` ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
2. å…¥åŠ›æ¬„ã«ã€Œç‚ã€ã¨å…¥åŠ›
3. ã€Œåˆ¤å®šã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. **æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š
   - ã€Œæ”»æ’ƒã€ã‚¿ã‚¤ãƒ—ã§ã€Œç«ã ã‚‹ã¾ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - Console ã« `ğŸ“Š è§£ææ¸ˆã¿ãƒ‡ãƒ¼ã‚¿` ã¨ `âœ…` ãƒ­ã‚°ãŒå‡ºç¾

### âš ï¸ ã‚¨ãƒ©ãƒ¼ç³»ãƒ†ã‚¹ãƒˆï¼ˆAPI ã‚¨ãƒ©ãƒ¼ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰

1. server.js ã® `GEMINI_API_KEY` ã‚’å‰Šé™¤ï¼ç©ºã«ã™ã‚‹
2. ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•
3. test-judge.html ã§åˆ¤å®šå®Ÿè¡Œ
4. **æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š
   - ã€Œâš ï¸ ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚¨ãƒ©ãƒ¼ã€ãªã©ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤º
   - Console ã« `âŒ JSON ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼` ãƒ­ã‚°ãŒå‡ºç¾
   - ã‚²ãƒ¼ãƒ ã¯æ­¢ã¾ã‚‰ãªã„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ä¸ç™ºæ‰±ã„ï¼‰

### ğŸ® ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰å‹•ä½œãƒ†ã‚¹ãƒˆ

1. test-judge.html ã§ã€Œå…‰ã€ã‚’åˆ¤å®š
2. type ãŒ "support" ã§è¡¨ç¤ºã•ã‚Œã‚‹
3. **æœŸå¾…ã•ã‚Œã‚‹çµæœ**ï¼š
   - `âœ¨ ã‚µãƒãƒ¼ãƒˆåŠ¹æœé©ç”¨` ãƒ­ã‚°ãŒå‡ºç¾
   - gameState ãŒæ›´æ–°ã•ã‚Œã‚‹
   - effectTarget ã«å¿œã˜ãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ãŒè¡Œã‚ã‚Œã‚‹

---

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

å®Ÿè£…ç¢ºèªé …ç›®ï¼š

- âœ… Gemini ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒã€ŒJSON ã®ã¿ã€ã‚’å³æ ¼ã«è¦æ±‚
- âœ… JSON æŠ½å‡ºå‡¦ç†ãŒè¤‡æ•°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œ
- âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—æ™‚ã«ã‚‚è©³ç´°ãƒ­ã‚°ã‚’å‡ºåŠ›
- âœ… ãƒ•ãƒ­ãƒ³ãƒˆå´ã§ `data.type`, `data.finalValue` ã® undefined ãƒã‚§ãƒƒã‚¯
- âœ… applySupport ã® effectTarget ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… DOM è¦ç´ ã®å­˜åœ¨ç¢ºèªï¼ˆif æ–‡ï¼‰
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‹ã‚Šã‚„ã™ã„
- âœ… ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã§åŸå› ç‰¹å®šãŒå¯èƒ½

---

## å‚è€ƒè³‡æ–™

- **server.js**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆè¡Œ 1370-1415ï¼‰
- **test-judge.html**: ãƒ†ã‚¹ãƒˆUI ã¨ API å‘¼ã³å‡ºã—å‡¦ç†
- **SUPPORT_CARD_FIX.md**: ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰æ©Ÿèƒ½ã®ä»•æ§˜æ›¸
- **ãƒ–ãƒ©ã‚¦ã‚¶ Developer Tools**: F12ã‚­ãƒ¼
