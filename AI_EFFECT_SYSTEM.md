# AIè¤‡é›‘åŠ¹æœãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

Node.js(Express) ã‚²ãƒ¼ãƒ ã«**AIãŒè¨€è‘‰ã®æ„å‘³ã‹ã‚‰ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŠ¹æœè¨­è¨ˆå›³ã‚’JSONå½¢å¼ã§ç”Ÿæˆãƒ»å®Ÿè¡Œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ **ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

---

## 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é©æ–°ï¼ˆGemini APIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰

### åŠ¹æœè¨­è¨ˆå›³ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆJSONï¼‰

Gemini APIã«ã‚µãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ç”Ÿæˆæ™‚ã€ä»¥ä¸‹ã®**logic ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã‚’å‡ºåŠ›ã•ã›ã¾ã™ï¼š

```json
{
  "type": "support",
  "effectName": "ã€è–åŸŸå…‰è‡¨ã€‘",
  "creativeDescription": "å¯¾è±¡ã®å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é‡å­çš„ã«å†æ§‹æˆã—ã€3ã‚¿ãƒ¼ãƒ³ã®é–“è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’43%è»½æ¸›ã™ã‚‹",
  "logic": {
    "target": "player",
    "actionType": "buff",
    "targetStat": "def",
    "value": 43,
    "duration": 3
  }
}
```

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆçµ±åˆå†…å®¹

- **rank ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: å¿…é ˆã€‚S/A/B/C/D/E ã‹ã‚‰é¸æŠ
- **logic ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**: å¿…é ˆï¼ˆSupport ã‚«ãƒ¼ãƒ‰ç”Ÿæˆæ™‚ï¼‰
  - `target`: "player" | "enemy"
  - `actionType`: "heal" | "buff" | "debuff" | "skip_turn" | "dot"
  - `targetStat`: "hp" | "atk" | "def" | "spd"
  - `value`: 0ï½100
  - `duration`: 0ï½3ï¼ˆã‚¿ãƒ¼ãƒ³æ•°ï¼‰
- **effectName**: AIãŒå‰µé€ ã—ãŸåŠ¹æœåï¼ˆä¾‹ï¼šã€Œã€è–åŸŸå…‰è‡¨ã€‘ã€ï¼‰
- **creativeDescription**: åŠ¹æœãƒ¡ã‚«ãƒ‹ã‚ºãƒ èª¬æ˜ï¼ˆ100-200å­—ï¼‰

### åˆ¤æ–­åŸºæº–

| ã‚«ãƒ¼ãƒ‰ä¾‹ | actionType | targetStat | value | duration |
|---------|-----------|-----------|-------|----------|
| ã€Œæ™‚æ­¢ã‚ã€ | skip_turn | spd | 100 | 1 |
| ã€ŒçŒ›æ¯’ã€ | dot | hp | 15 | 3 |
| ã€Œé‰„å£ã€ | buff | def | 50 | 2 |
| ã€ŒHPå›å¾©ã€ | heal | hp | 30 | 0 |

---

## 2. ã‚µãƒ¼ãƒãƒ¼å´åŠ¹æœå®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆserver.jsï¼‰

### `applyAiEffect()` é–¢æ•°

```javascript
function applyAiEffect(player, enemy, logic, meta = {}) {
  // â˜… logic ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚²ãƒ¼ãƒ ã‚¹ãƒ†ãƒ¼ãƒˆã«åæ˜ 
  // target: "player" â†’ player ã«é©ç”¨ã€"enemy" â†’ enemy ã«é©ç”¨
  // actionType: heal, buff, debuff, skip_turn, dot
  // å¯¾è±¡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»é…åˆ—ã‚’ç›´æ¥å¤‰æ›´
}
```

### å®Ÿè£…æ¸ˆã¿åŠ¹æœã‚¿ã‚¤ãƒ—

#### 1. **heal** - å³åº§å›å¾©
```javascript
target.hp += value;
// HP ã‚’ç›´æ¥å›å¾©
```

#### 2. **buff/debuff** - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
```javascript
if (targetStat === 'atk') target.atkMultiplier += (value / 100);
if (targetStat === 'def') target.defMultiplier += (value / 100);
if (targetStat === 'spd') target.speed += value;
// ãƒãƒ•ç³»çµ±ãŒæ™‚é–“åˆ¶é™ãªã‚‰ activeEffects ã«ç™»éŒ²
```

#### 3. **skip_turn** - ã‚¿ãƒ¼ãƒ³ã‚¹ã‚­ãƒƒãƒ—
```javascript
target.skipTurns = duration;
target.canAction = false;
// æ¬¡ã‚¿ãƒ¼ãƒ³æ±ºå®šæ™‚ã« advanceTurnIndexWithSkips() ã§å‡¦ç†
```

#### 4. **dot** - ç¶™ç¶šãƒ€ãƒ¡ãƒ¼ã‚¸
```javascript
target.statusAilments.push({
  name: effectName,
  turns: duration,
  effectType: 'dot',
  value: value
});
// ã‚¿ãƒ¼ãƒ³é–‹å§‹æ™‚ã« tickStatusEffects() ã§è‡ªå‹•é©ç”¨
```

### ã‚µãƒãƒ¼ãƒˆå®Ÿè¡Œãƒ•ãƒ­ãƒ¼

1. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ `supportAction` ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ï¼ˆã‚µãƒãƒ¼ãƒˆãƒ¯ãƒ¼ãƒ‰ï¼‰
2. ã‚µãƒ¼ãƒãƒ¼ Gemini ã§ã‚«ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆlogic å«ã‚€ï¼‰
3. **AIåŠ¹æœè¨­è¨ˆå›³ã®å®Ÿè¡Œ**: `applyAiEffect(player, opponent, card.logic)`
4. **æ—¢å­˜ supportType å‡¦ç†**: äº’æ›æ€§ã®ãŸã‚æ—¢å­˜ã® switch-case ã‚‚å®Ÿè¡Œ
5. **activeEffects ç™»éŒ²**: AIã® effectName/duration ã‚’ activeEffects ã«è¨˜éŒ²
6. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé€šçŸ¥**: supportUsed ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆcardData ã« logic å«ã‚€ï¼‰

---

## 3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´è¡¨ç¤ºï¼ˆgame.jsï¼‰

### ã‚µãƒãƒ¼ãƒˆæ¼”å‡ºè¡¨ç¤º

#### A. `showSupportOverlay()` - ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³æ¼”å‡º

```javascript
// æ”¯æ´ã‚¿ã‚¤ãƒ—åˆ¥ã®èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ + ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
// è¡¨ç¤ºå†…å®¹:
// 1. effectNameï¼ˆAIãŒç”Ÿæˆã—ãŸåŠ¹æœåï¼‰
// 2. creativeDescriptionï¼ˆåŠ¹æœãƒ¡ã‚«ãƒ‹ã‚ºãƒ èª¬æ˜ï¼‰
// 3. supportMessageï¼ˆå¾“æ¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
// 4. specialEffectï¼ˆç‰¹æ®ŠåŠ¹æœãƒ†ã‚­ã‚¹ãƒˆï¼‰
```

#### B. `updateActiveEffectsList()` - æŒç¶šåŠ¹æœãƒªã‚¹ãƒˆ

```javascript
// activeEffects é…åˆ—ã‹ã‚‰ç™ºå‹•ä¸­ã®åŠ¹æœã‚’ãƒãƒƒã‚¸è¡¨ç¤º
// ä¾‹ï¼š
// ğŸ“ˆ é˜²å¾¡å¼·åŒ– (ã‚ã¨2ã‚¿ãƒ¼ãƒ³)
// â° ã‚¿ãƒ¼ãƒ³ã‚¹ã‚­ãƒƒãƒ— (ã‚ã¨1ã‚¿ãƒ¼ãƒ³)
// â˜ ï¸ æ¯’ (ã‚ã¨3ã‚¿ãƒ¼ãƒ³)
```

#### C. `syncTurnState()` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åŒæœŸ

```javascript
// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å—ã‘å–ã£ãŸ activeEffects ã‚’ UI ã«åæ˜ 
// - æŒç¶šåŠ¹æœã®è¦‹ãŸç›®æ›´æ–°
// - ã‚¿ãƒ¼ãƒ³ã”ã¨ã®è‡ªå‹•ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
// - æœŸé™åˆ‡ã‚ŒåŠ¹æœã®å‰Šé™¤é€šçŸ¥
```

### mechanicType åˆ¥ UIå‡¦ç†

```javascript
switch (mechanicType) {
  case 'stat_boost':    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¼·åŒ–ï¼šæ•°å€¤è¡¨ç¤ºï¼†ãƒ­ã‚°
  case 'field_change':  // ç’°å¢ƒå¤‰åŒ–ï¼šèƒŒæ™¯æ›´æ–°ï¼†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒƒã‚¸
  case 'status_ailment': // çŠ¶æ…‹ç•°å¸¸ï¼šæ¯’ã‚¢ã‚¤ã‚³ãƒ³ï¼†DoT ãƒ€ãƒ¡ãƒ¼ã‚¸
  case 'turn_manipulation': // ã‚¿ãƒ¼ãƒ³æ“ä½œï¼šã‚¹ã‚­ãƒƒãƒ—é€šçŸ¥
  case 'special':       // ç‰¹æ®ŠåŠ¹æœï¼šeffectName è¡¨ç¤º
}
```

---

## 4. å®Ÿè£…ä¾‹ï¼šã€Œæ™‚æ­¢ã‚ã€ã‚«ãƒ¼ãƒ‰

### Gemini ãŒå‡ºåŠ›ã™ã‚‹ JSON

```json
{
  "role": "Support",
  "name": "æ™‚æ­¢ã‚",
  "rank": "A",
  "element": "å…‰",
  "supportType": "counter",
  "supportMessage": "æ¬¡ã‚¿ãƒ¼ãƒ³ã®æ•µã®è¡Œå‹•ã‚’å®Œå…¨ã«åœæ­¢ã•ã›ã‚‹",
  "specialEffect": "ã€æ™‚ç©ºè»¢ç§»ã€‘",
  "effectName": "ã€æ™‚ç©ºåœæ»åŸŸã€‘",
  "creativeDescription": "å¯¾è±¡ã®æ™‚é–“ã‚’åœæ­¢ã•ã›ã€3ã‚¿ãƒ¼ãƒ³è‡ªç”±ã«è¡Œå‹•ã§ããªã„ã€‚ç©¶æ¥µã®é˜²å¾¡åŠ¹æœã€‚",
  "logic": {
    "target": "enemy",
    "actionType": "skip_turn",
    "targetStat": "spd",
    "value": 100,
    "duration": 1
  },
  "mechanicType": "turn_manipulation",
  "targetStat": "turn_count",
  "duration": 1
}
```

### ã‚µãƒ¼ãƒãƒ¼å‡¦ç†

```javascript
// 1. AIåŠ¹æœè¨­è¨ˆå›³å®Ÿè¡Œ
applyAiEffect(player, opponent, card.logic);
// â†’ opponent.skipTurns = 1; opponent.canAction = false;

// 2. activeEffects ç™»éŒ²
opponent.activeEffects.push({
  name: "ã€æ™‚ç©ºåœæ»åŸŸã€‘",
  duration: 1,
  type: "turn_manipulation"
});

// 3. ã‚¿ãƒ¼ãƒ³æ±ºå®šæ™‚
advanceTurnIndexWithSkips(room);
// â†’ opponent ã®ã‚¹ã‚­ãƒƒãƒ—ã‚¿ãƒ¼ãƒ³ã‚’ç¢ºèªã—ã€æ¬¡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ç§»è¡Œ
```

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¡¨ç¤º

```
ã€ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³æ¼”å‡ºã€‘
â° æ™‚æ­¢ã‚
ã€æ™‚ç©ºåœæ»åŸŸã€‘
å¯¾è±¡ã®æ™‚é–“ã‚’åœæ­¢ã•ã›ã€3ã‚¿ãƒ¼ãƒ³è‡ªç”±ã«è¡Œå‹•ã§ããªã„ã€‚ç©¶æ¥µã®é˜²å¾¡åŠ¹æœã€‚

ã€ãƒãƒƒã‚¸è¡¨ç¤ºã€‘
â° ã€æ™‚ç©ºåœæ»åŸŸã€‘ (ã‚ã¨1ã‚¿ãƒ¼ãƒ³)
```

---

## 5. ä¸»è¦ãªè¿½åŠ ãƒ»å¤‰æ›´ã‚³ãƒ¼ãƒ‰

### ã‚µãƒ¼ãƒãƒ¼å´

| ãƒ•ã‚¡ã‚¤ãƒ« | è¿½åŠ å†…å®¹ |
|---------|---------|
| server.js | `applyAiEffect()` é–¢æ•° |
| server.js | `advanceTurnIndexWithSkips()` é–¢æ•° |
| server.js | Gemini ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ‹¡å¼µï¼ˆlogic, effectName, creativeDescriptionï¼‰ |
| server.js | `supportAction` ãƒãƒ³ãƒ‰ãƒ©å†…ã® AI åŠ¹æœå®Ÿè¡Œ |
| server.js | `skipTurns`, `canAction` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åˆæœŸåŒ– |

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´

| ãƒ•ã‚¡ã‚¤ãƒ« | å®Ÿè£…æ¸ˆã¿ |
|---------|---------|
| game.js | `showSupportOverlay()` - effectName/creativeDescription è¡¨ç¤º |
| game.js | `updateActiveEffectsList()` - æŒç¶šåŠ¹æœãƒãƒƒã‚¸è¡¨ç¤º |
| game.js | `supportUsed` ã‚¤ãƒ™ãƒ³ãƒˆ handler - mechanicType åˆ†å² |
| game.js | `syncTurnState()` - activeEffects åŒæœŸ |

---

## 6. ãƒ†ã‚¹ãƒˆ & å‹•ä½œç¢ºèª

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

1. **heal ã‚«ãƒ¼ãƒ‰**
   - å…¥åŠ›: ã€Œæ°´ã€â†’ heal ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
   - æœŸå¾…: HP å›å¾© + ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º

2. **buff ã‚«ãƒ¼ãƒ‰**
   - å…¥åŠ›: ã€Œé‰„å£ã€â†’ buff ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
   - æœŸå¾…: é˜²å¾¡åŠ› UP + activeEffects ãƒãƒƒã‚¸è¡¨ç¤º

3. **skip_turn ã‚«ãƒ¼ãƒ‰**
   - å…¥åŠ›: ã€Œæ™‚æ­¢ã‚ã€â†’ skip_turn ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
   - æœŸå¾…: æ•µã‚¿ãƒ¼ãƒ³ ã‚¹ã‚­ãƒƒãƒ— + â° ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º

4. **dot ã‚«ãƒ¼ãƒ‰**
   - å…¥åŠ›: ã€ŒçŒ›æ¯’ã€â†’ dot ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
   - æœŸå¾…: ã‚¿ãƒ¼ãƒ³é–‹å§‹æ™‚ã«ç¶™ç¶šãƒ€ãƒ¡ãƒ¼ã‚¸ + â˜ ï¸ ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º

### æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ

```javascript
// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã§åŠ¹æœå®Ÿè¡Œã‚’ç¢ºèª
console.log(`ğŸ² AIåŠ¹æœè¨­è¨ˆå›³å®Ÿè¡Œ: ${effectName}`, aiEffectResult.message);

// ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ä¾‹ï¼š
// ğŸ² AIåŠ¹æœè¨­è¨ˆå›³å®Ÿè¡Œ: ã€æ™‚ç©ºåœæ»åŸŸã€‘
// â­ï¸ æ•µ ã®ã‚¿ãƒ¼ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ— (æ®‹ã‚Š0ã‚¿ãƒ¼ãƒ³)
```

---

## 7. æ‹¡å¼µæ€§

ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®æ‹¡å¼µã«å¯¾å¿œï¼š

- **æ–° actionType ã®è¿½åŠ **: `heals`, `shield`, `taunt` ãªã©
- **æ–° targetStat ã®è¿½åŠ **: `critical`, `evasion`, `accuracy` ãªã©
- **è¤‡åˆåŠ¹æœ**: è¤‡æ•°ã® logic ã‚’è¤‡åˆå®Ÿè¡Œ
- **æ¡ä»¶ä»˜ãåŠ¹æœ**: ã‚¿ãƒ¼ãƒ³æ•°ã«å¿œã˜ãŸæ®µéšçš„åŠ¹æœå¤‰åŒ–
- **AIå‰µé€ çš„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ**: effectName æ¯ã«ç•°ãªã‚‹è¦–è¦šæ¼”å‡º

---

## çµè«–

**AIãŒè¨€è‘‰ã®æ„å‘³ã‹ã‚‰è¤‡é›‘ãªã‚²ãƒ¼ãƒ åŠ¹æœã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç”Ÿæˆãƒ»å®Ÿè¡Œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ **ãŒå®Œæˆã€‚
- å˜ãªã‚‹æ•°å€¤ã®ä¹±æ•°åŒ–ã§ã¯ãªãã€**ã‚²ãƒ¼ãƒ æŒ™å‹•ãã®ã‚‚ã®ã‚’AIãŒæ±ºå®š**
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¡¨ç¤ºã¨ã®å®Œå…¨åŒæœŸã«ã‚ˆã‚Šã€**è¦–è¦šçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚‚è‡ªå‹•åŒ–**
- æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ãƒ»åŠ¹æœã®è¿½åŠ ãŒå®¹æ˜“ãª**æ‹¡å¼µæ€§ã®é«˜ã„è¨­è¨ˆ**
