<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>オンラインバトルカードゲーム</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header class="hero">
      <div class="hero-text">
        <p class="hero-kicker">Nintendo Pop Style</p>
        <h1>オンラインバトルカードゲーム</h1>
        <p class="hero-sub">好きな言葉がカードになる！ ポップでワクワクするリアルタイムバトル。</p>
      </div>
      <div class="hero-badge-group">
        <div class="hero-badge">Gemini 深層審判</div>
        <div id="winCountBadge" class="hero-badge win-badge hidden">🏆 0勝</div>
      </div>
    </header>

    <div id="homeSection" class="section card">
      <h2>マッチングを開始</h2>
      <p class="description">プレイヤー名を入力し、対戦方法を選んで出発しよう！</p>
      <div class="home-grid">
        <div class="input-stack">
          <label class="input-label" for="playerNameInput">プレイヤー名</label>
          <input type="text" id="playerNameInput" class="mega-input" placeholder="あなたの名前" maxlength="20">
          <div class="password-wrap hidden" id="passwordWrap">
            <label class="input-label" for="passwordInput">パスワード</label>
            <input type="text" id="passwordInput" class="mega-input" placeholder="合言葉を入力" maxlength="20">
          </div>
        </div>
        <div class="match-cards">
          <div class="match-card selected" data-mode="random" id="matchCardRandom">
            <div class="match-icon">🌐</div>
            <div class="match-title">誰とでも</div>
            <div class="match-desc">ランダムマッチで世界の誰かと即対戦！</div>
          </div>
          <div class="match-card" data-mode="password" id="matchCardPassword">
            <div class="match-icon">🔒</div>
            <div class="match-title">パスワード</div>
            <div class="match-desc">友だちと合言葉でマッチしよう。</div>
          </div>
        </div>
      </div>
      <div class="home-actions">
        <button id="matchStartBtn" class="btn btn-primary">マッチを開始！</button>
      </div>
    </div>

    <div id="matchingSection" class="section card hidden">
      <h2>マッチング待機中...</h2>
      <p id="matchingMessage" class="description">対戦相手をさがしています...</p>
      <div class="matching-indicator">
        <div class="spinner"></div>
        <div class="matching-text">Searching...</div>
      </div>
      <button id="cancelMatchingBtn" class="btn btn-secondary">マッチングをキャンセル</button>
    </div>

    <div id="waitingSection" class="section card hidden">
      <h2>ウェイティングルーム</h2>
      <p id="waitingInfo" class="description"></p>
      <div id="playerList" class="battle-log"></div>
      <div class="home-actions">
        <button id="startBattleBtn" class="btn btn-battle" disabled>バトル開始</button>
        <button id="waitingCancelBtn" class="btn btn-secondary">マッチングをキャンセル</button>
      </div>
    </div>

    <div id="battleSection" class="section card hidden">
      <div id="turnBanner" class="turn-banner">
        <div id="turnBannerText" class="turn-banner-text">あなたの番</div>
      </div>

      <div class="battle-top">
        <div class="battle-status">
          <div id="statusMessage" class="status-message"></div>
        </div>
        <div id="turnIndicator" class="turn-indicator">あなたのターン</div>
        <div class="affinity-helper">
          <button id="affinityToggle" class="affinity-btn">？ 属性相性</button>
          <button id="supportGuideBtn" class="guide-btn">Support Guide</button>
          <div id="affinityPanel" class="affinity-panel hidden">
            <div class="affinity-header">
              <span>属性相性チャート</span>
              <button id="affinityClose" class="affinity-close">×</button>
            </div>
            <div class="affinity-grid">
              <div class="affinity-row"><span class="affinity-attr fire">火</span><span>→ 土に強い</span><span>← 水に弱い</span></div>
              <div class="affinity-row"><span class="affinity-attr earth">土</span><span>→ 風に強い</span><span>← 火に弱い</span></div>
              <div class="affinity-row"><span class="affinity-attr wind">風</span><span>→ 雷に強い</span><span>← 土に弱い</span></div>
              <div class="affinity-row"><span class="affinity-attr thunder">雷</span><span>→ 水に強い</span><span>← 風に弱い</span></div>
              <div class="affinity-row"><span class="affinity-attr water">水</span><span>→ 火に強い</span><span>← 雷に弱い</span></div>
              <div class="affinity-row"><span class="affinity-attr light">光</span><span>↔ 闇と相互弱点</span></div>
              <div class="affinity-row"><span class="affinity-attr dark">闇</span><span>↔ 光と相互弱点</span></div>
            </div>
            <div class="affinity-note">強: x1.5 / 弱: x0.5。光と闇は互いに大ダメージ。</div>
          </div>
        </div>
      </div>

      <div id="effectContainer" class="effect-container"></div>
      <div class="battle-arena">
        <div class="player-area">
          <h3>あなた</h3>
          <div class="health-bar">
            <div id="myHealthFill" class="health-fill"><span id="myHealthText">100</span></div>
          </div>
          <div class="resource-bars">
            <div class="resource-bar stamina">
              <div id="myStaminaFill" class="resource-fill">
                <span id="myStaminaText">100</span>
              </div>
            </div>
            <div class="resource-bar magic">
              <div id="myMagicFill" class="resource-fill">
                <span id="myMagicText">100</span>
              </div>
            </div>
          </div>
        </div>
        <div class="vs-divider">VS</div>
        <div class="player-area">
          <h3>相手</h3>
          <div class="health-bar">
            <div id="opHealthFill" class="health-fill"><span id="opHealthText">100</span></div>
          </div>
          <div class="resource-bars">
            <div class="resource-bar stamina">
              <div id="opStaminaFill" class="resource-fill">
                <span id="opStaminaText">100</span>
              </div>
            </div>
            <div class="resource-bar magic">
              <div id="opMagicFill" class="resource-fill">
                <span id="opMagicText">100</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="battle-inputs">
        <div class="phase-card">
          <div class="phase-title">攻撃 / サポート</div>
          <div class="input-group">
            <input type="text" id="attackWordInput" class="mega-input" placeholder="攻撃またはサポートの言葉" maxlength="20">
            <button id="attackBtn" class="btn btn-primary">攻撃する</button>
            <button id="supportBtn" class="btn btn-support">🌟 サポート</button>
          </div>
          <div id="supportCounter" class="support-counter">サポート残り: <span id="supportRemaining">3</span>/3</div>
          <small>同じ言葉の再利用は禁止です。</small>
        </div>

        <div class="phase-card">
          <div class="phase-title">防御</div>
          <p class="description">防御入力は攻撃宣言後に中央ポップアップで行います。</p>
        </div>
      </div>

      <div id="battleLog" class="battle-log"></div>
    </div>

    <!-- カットイン演出用モーダル -->
    <div id="cutinModal" class="cutin-overlay hidden">
      <div class="cutin-content">
        <div class="cutin-judge-title">⚡ 審判結果 ⚡</div>
        <div class="cutin-word" id="cutinWord"></div>
        <div class="cutin-stats" id="cutinStats"></div>
        <div class="cutin-role-badge" id="cutinRoleBadge"></div>
        <div class="cutin-tier" id="cutinTier"></div>
        <div class="cutin-special" id="cutinSpecial"></div>
        <div class="cutin-comment" id="cutinComment"></div>
      </div>
    </div>

    <!-- Defense Popup Modal -->
    <div id="defenseModal" class="modal-overlay hidden">
      <div class="modal-content pop-defense">
        <div class="modal-icon">❗</div>
        <h2>防御フェーズ</h2>
        <p id="defenseModalMessage" class="modal-message">相手の攻撃を防御してください！</p>
        <div class="modal-input-group">
          <input type="text" id="defenseModalInput" placeholder="防御の言葉を入力" maxlength="20">
          <button id="defenseModalBtn" class="btn btn-primary">防御実行</button>
        </div>
        <small>攻撃ワードを入れると防御失敗になります</small>
      </div>
    </div>

    <div id="supportGuideModal" class="modal-overlay hidden">
      <div class="modal-content guide-modal">
        <div class="modal-icon">🌟</div>
        <h2>サポートガイド</h2>
        <p class="modal-message">サポート単語でできること：HP回復、最大HP上昇、フィールド変更、属性付与、相手へのデバフ、ST/MP回復など、言葉の意味次第で無限の可能性があります！</p>
        <p class="modal-message">ユニークな語を入力すると、例えば「銀行」なら利息で毎ターンHP回復、「温泉」なら継続回復フィールドなど、自由な効果が生まれます。</p>
        <button id="supportGuideClose" class="btn btn-secondary">閉じる</button>
      </div>
    </div>

    <div id="resultSection" class="section card hidden">
      <h2>リザルト</h2>
      <p id="resultMessage" class="description"></p>
      <button id="returnHomeBtn" class="btn btn-primary">ホームに戻る</button>
    </div>
  </div>

  <div id="supportOverlay" class="support-overlay hidden">
    <div class="support-overlay-content">
      <div class="support-overlay-title">SUPPORT ACTIVATED!</div>
      <div id="supportOverlayDetail" class="support-overlay-detail"></div>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="game.js"></script>
</body>
</html>
